<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Esports Company Management Simulation ‚Ä¢ Manager X</title>
  <meta name="description" content="A turn‚Äëbased, 8‚Äëturn (2‚Äëyear) esports org management simulation. Make 3 decisions per turn and maximize rank + profit." />
  <style>
    :root{
      --bg:#0b1020; --panel:#111936; --panel-2:#0e1530; --ink:#e8eeff; --muted:#a9b7da; --line:#263a74; --accent:#6aa8ff;
      --good:#10b981; --warn:#f59e0b; --bad:#ef4444; --shadow:rgba(0,0,0,.35)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg, #0b1020, #0a0f1f);color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    a{color:var(--accent)}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap}
    h1{font-size:clamp(22px,3vw,28px);margin:0}
    h2{font-size:20px;margin:16px 0 8px 0;color:#cfe1ff}
    h3{font-size:18px;margin:12px 0 8px 0;color:#cfe1ff}
    .badge{padding:4px 10px;border:1px solid var(--line);border-radius:999px;background:#0f1630;color:#cfe1ff;white-space:nowrap}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 10px 26px var(--shadow)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid var(--line);background:#10183a;color:#dfe9ff;padding:10px 14px;border-radius:12px;cursor:pointer;font-size:14px}
    .btn:hover{filter:brightness(1.08)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg,#1a3d86,#0e2b66);border-color:#2453a5}
    .btn.good{background:linear-gradient(180deg,#167a3a,#0e5d2b);border-color:#1a8f46}
    .btn.warn{background:linear-gradient(180deg,#8a5a10,#5f3f0b);border-color:#b07217}
    .btn.bad{background:linear-gradient(180deg,#7a1620,#5d0e14);border-color:#8f1a25}
    .btn.ghost{background:#0f1632}
    .section-title{margin:0 0 8px 0;font-weight:800;font-size:14px;color:#cfe1ff;text-transform:uppercase;letter-spacing:.08em}
    .stats{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    @media(min-width:760px){.stats{grid-template-columns:repeat(3,1fr)}}
    .stat{background:var(--panel-2);border:1px solid var(--line);border-radius:12px;padding:10px}
    .stat b{display:block;font-size:12px;color:#bcd0ff;text-transform:uppercase;letter-spacing:.08em}
    .label{font-size:12px;color:#bcd0ff}
    .muted{color:var(--muted)}
    .opts{display:grid;gap:12px}
    .opt{display:flex;gap:12px;align-items:flex-start;background:var(--panel-2);border:1px solid var(--line);border-radius:12px;padding:12px}
    .opt input{margin-top:4px}
    .divider{height:1px;background:var(--line);margin:10px 0}
    .log{max-height:240px;overflow:auto;background:#0f1632;border:1px solid var(--line);border-radius:12px;padding:10px;white-space:pre-wrap;font-size:13px;line-height:1.6}
    .footer{margin-top:18px;color:#9fb2e6;font-size:14px}
    .kbd{background:#131d3e;border:1px solid var(--line);border-bottom-color:#1b2a5b;padding:2px 6px;border-radius:6px}
    .notice{padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#0e1633}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;background:#0d1534;border:1px solid var(--line);border-radius:999px}
    .center{display:flex;justify-content:center;align-items:center}
    .end{display:flex;justify-content:flex-end}
    .warntext{color:var(--warn)}
    .goodtext{color:var(--good)}
    .badtext{color:var(--bad)}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    
    /* Modal styles */
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:1000;padding:20px}
    .modal{background:var(--panel);border:2px solid var(--accent);border-radius:16px;max-width:700px;max-height:90vh;overflow-y:auto;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
    .modal h2{margin-top:0;color:#6aa8ff}
    .modal ul{margin:8px 0;padding-left:24px}
    .modal li{margin:4px 0}
    .term{background:var(--panel-2);border-left:3px solid var(--accent);padding:8px 12px;margin:8px 0;border-radius:4px}
    .term strong{color:#6aa8ff}
    .highlight{background:rgba(106,168,255,0.15);padding:2px 6px;border-radius:4px;color:#6aa8ff}
    details{margin:12px 0;background:var(--panel-2);border:1px solid var(--line);border-radius:12px;padding:12px}
    summary{cursor:pointer;font-weight:600;color:#cfe1ff;user-select:none}
    summary:hover{color:var(--accent)}
    .help-icon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:18px;background:var(--accent);color:white;border-radius:50%;font-size:12px;font-weight:bold;cursor:help;margin-left:4px}
  </style>
</head>
<body>
  <!-- Tutorial Modal -->
  <div id="tutorialModal" class="modal-overlay" style="display:none">
    <div class="modal">
      <h2>üìö Welcome to Esports Company Management!</h2>
      
      <p>You're the manager of a new esports organization. Your goal is to build a successful team over <strong>8 turns (2 years)</strong> by making smart business decisions.</p>
      
      <h3>üéÆ How to Play</h3>
      <ol>
        <li><strong>Each turn = 3 months (one quarter)</strong> of company operations</li>
        <li><strong>Make 3 decisions per turn</strong> ‚Äî one from each category:
          <ul>
            <li><span class="highlight">Operations</span>: Infrastructure & support staff</li>
            <li><span class="highlight">Marketing</span>: Growing your fanbase & revenue</li>
            <li><span class="highlight">Player Focus</span>: Training & team culture</li>
          </ul>
        </li>
        <li><strong>Random choices each turn:</strong> You'll see 3 different options per category each turn</li>
        <li><strong>Your team competes in a tournament each turn</strong> ‚Äî win probability depends on TSR & morale</li>
        <li><strong>Manage your finances</strong> ‚Äî balance expenses with tournament prizes and sponsorships</li>
        <li><strong>Survive 8 turns</strong> without running out of money or losing player morale</li>
        <li><strong>Maximize your final score</strong> based on team rank, profit, and fanbase</li>
      </ol>

      <h3>üìä Key Terms & Metrics</h3>
      
      <div class="term">
        <strong>Cash Reserves:</strong> Your available money. You start with $250,000. If you go negative for 2 turns in a row, you declare bankruptcy and lose!
      </div>
      
      <div class="term">
        <strong>Salaries (Fixed Costs):</strong> Money you pay your team every turn. Starts at $30,000/turn and increases if you hire more staff (like analysts).
      </div>
      
      <div class="term">
        <strong>TSR (Team Skill Rating):</strong> How good your players are at competing (0-100 scale). Higher TSR = better win probability & tournament prizes. Improves through training and analysts.
      </div>
      
      <div class="term">
        <strong>Morale:</strong> How happy your players are (0-100 scale). Affects tournament performance. If morale hits 0, your players quit and you lose! Balance training intensity with team bonding.
      </div>
      
      <div class="term">
        <strong>Fans:</strong> Your fanbase size. More fans = promotion requirements met faster. Fans grow through marketing, tournaments, and winning.
      </div>
      
      <div class="term">
        <strong>Rank (Tier):</strong> Your team's competitive tier based on TSR and fanbase:
        <ul>
          <li><strong>Tier 3 (Rookie):</strong> Starting teams, TSR < 70, $20K prize when you win</li>
          <li><strong>Tier 2 (Challenger):</strong> Mid-level teams, TSR 70-79, $35K prize when you win</li>
          <li><strong>Tier 1 (Elite):</strong> Top-tier teams, TSR 80+, $60K prize when you win</li>
        </ul>
      </div>

      <h3>üí° Strategy Tips</h3>
      <ul>
        <li><strong>Adapt to what you're offered:</strong> Each turn presents different choices - be flexible!</li>
        <li><strong>Win tournaments early!</strong> Prize money is your main income source. Build TSR fast.</li>
        <li><strong>Watch your fixed costs:</strong> Some decisions permanently increase salaries.</li>
        <li><strong>TSR vs Morale trade-offs:</strong> Both affect win probability - find the right balance.</li>
        <li><strong>No perfect strategy:</strong> With randomized options, you'll need to adapt each playthrough!</li>
      </ul>

      <h3>üèÜ Winning the Game</h3>
      <p><strong>Multiple ways to win!</strong> Your final score is based on three factors:</p>
      <ul>
        <li><strong>40% Team Rank</strong> (Tier 1 = 100 pts, Tier 2 = 60 pts, Tier 3 = 30 pts)</li>
        <li><strong>40% Profit</strong> (Ending cash minus starting $250K)</li>
        <li><strong>20% Fanbase</strong> (Scale up to 20,000+ fans)</li>
      </ul>

      <div class="term">
        <strong>Grade Levels:</strong>
        <ul style="margin-top:8px">
          <li><strong>40+ points & survived:</strong> PASSING ‚úÖ - You kept the org alive!</li>
          <li><strong>50+ points:</strong> MODERATE SUCCESS üëç - Solid performance</li>
          <li><strong>60+ points:</strong> SOLID SUCCESS ‚úÖ‚úÖ - Sustainable org</li>
          <li><strong>70+ points:</strong> STRONG SUCCESS üéØ - Excellent management</li>
          <li><strong>Special Achievements:</strong> Elite rank + 15K fans + $50K profit = <strong>TOTAL DOMINATION üèÜ</strong></li>
        </ul>
      </div>

      <div class="term">
        <strong>Alternative Win Paths (Grade A+ regardless of total score):</strong>
        <ul style="margin-top:8px">
          <li><strong>Financial Mogul:</strong> Make $100K+ profit (pure business focus)</li>
          <li><strong>Brand Builder:</strong> Reach 20K+ fans with Tier 2+ rank (massive fanbase)</li>
          <li><strong>Elite Competitor:</strong> Tier 1 rank with TSR 85+ (pure performance)</li>
        </ul>
      </div>

      <p><strong>Key Insight:</strong> You don't need to excel at everything! Pick a strategy and master it. Financial genius? Focus on profit. Performance-driven? Push for Elite rank. Brand building? Grow that fanbase!</p>

      <div class="row" style="justify-content:center;margin-top:20px">
        <button class="btn primary" id="btnStartGame"><b>Got It! Start Playing ‚Üí</b></button>
      </div>
      
      <p class="muted" style="text-align:center;margin-top:12px;font-size:13px">
        You can review the glossary anytime by clicking "View Glossary" in the sidebar
      </p>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div class="row">
        <h1>Esports Company Management Simulation</h1>
        <span class="badge">Manager X ¬∑ 8 Turns ¬∑ Dynamic Choices</span>
      </div>
      <div class="row">
        <button class="btn ghost" id="btnHelp">üìö Tutorial</button>
        <button class="btn ghost" id="btnSave">Save</button>
        <button class="btn ghost" id="btnLoad">Load</button>
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn" id="btnPrint">Print</button>
      </div>
      <div class="row" id="nameRow" style="gap:8px;align-items:center">
        <label class="label" for="studentName">Student Name</label>
        <input id="studentName" type="text" placeholder="Enter your name" style="min-width:240px;padding:8px;background:#0e1530;border:1px solid var(--line);border-radius:8px;color:var(--ink)" />
      </div>
    </header>

    <div class="grid">
      <section class="card" id="left">
        <div class="section-title">Scenario</div>
        <div id="scenario" class="notice" aria-live="polite"></div>

        <div class="divider"></div>
        <div class="section-title">Decisions (pick 1 in each category)</div>
        <p class="muted" style="font-size:13px;margin-top:0">üí° Options are randomized each turn - adapt your strategy!</p>

        <form id="choices" class="opts">
          <fieldset class="card" style="padding:12px;border:none">
            <legend class="label">1) Operations <span class="help-icon" title="Infrastructure and support staff decisions">?</span></legend>
            <div id="opsOptions"></div>
          </fieldset>

          <fieldset class="card" style="padding:12px;border:none">
            <legend class="label">2) Marketing <span class="help-icon" title="Growing your fanbase and revenue streams">?</span></legend>
            <div id="mktOptions"></div>
          </fieldset>

          <fieldset class="card" style="padding:12px;border:none">
            <legend class="label">3) Player Focus <span class="help-icon" title="Training intensity vs team culture balance">?</span></legend>
            <div id="plyOptions"></div>
          </fieldset>
        </form>

        <div class="row end" style="margin-top:10px">
          <button class="btn primary" id="btnConfirm"><b>Confirm Decisions & Run Turn</b></button>
        </div>

        <div class="divider"></div>
        <div class="section-title">Turn Log</div>
        <div id="log" class="log" aria-live="polite"></div>
      </section>

      <aside class="card" id="right">
        <div id="turnSummary" style="display:none;margin-bottom:16px">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div class="section-title" style="margin:0">Last Turn Results</div>
            <button class="btn ghost" id="btnDismissSummary" style="padding:4px 8px;font-size:12px">‚úï Dismiss</button>
          </div>
          <div id="turnSummaryContent"></div>
        </div>
        
        <div class="section-title">Status</div>
        <div class="stats" id="stats"></div>
        
        <div class="divider"></div>
        <details>
          <summary>üìñ View Glossary</summary>
          <div style="margin-top:12px;font-size:14px">
            <p><strong>Cash:</strong> Available money. Start: $250K. Bankruptcy if negative for 2 turns.</p>
            <p><strong>Salaries:</strong> Fixed costs paid each turn. Start: $30K/turn.</p>
            <p><strong>TSR:</strong> Team Skill Rating (0-100). Higher = better win chance & tournament prizes.</p>
            <p><strong>Morale:</strong> Player happiness (0-100). Affects performance. Reaches 0 = players quit = game over.</p>
            <p><strong>Fans:</strong> Fanbase size. Required for rank promotions (7K for Tier 2, 12K for Tier 1).</p>
            <p><strong>Rank:</strong> Tier 3 (Rookie, $20K prize) ‚Üí Tier 2 (Challenger, $35K) ‚Üí Tier 1 (Elite, $60K)</p>
            <p><strong>Tournaments:</strong> Each turn has a tournament. Win = prize money + fans. Lose = penalty ‚àí fans.</p>
          </div>
        </details>
        
        <div class="divider"></div>
        <div class="section-title">Quick Reference</div>
        <ul class="muted" style="margin-top:0;font-size:14px">
          <li>Game is 8 turns (2 years; 1 turn = quarter).</li>
          <li>Pick <b>one</b> option per category each turn.</li>
          <li><b>Random options</b> each turn for replayability!</li>
          <li>Every turn: tournament competition for prizes!</li>
          <li>Win probability = (TSR √ó Morale%) √∑ opponent strength</li>
          <li>Balance spending, training, and team happiness!</li>
        </ul>
        
        <div class="divider"></div>
        <details>
          <summary>üéØ How Scoring Works</summary>
          <div style="margin-top:8px;font-size:14px">
            <p class="muted"><strong>Final Score = Rank (40%) + Profit (40%) + Fans (20%)</strong></p>
            <p class="muted">Rank: Tier 1=100pts, Tier 2=60pts, Tier 3=30pts</p>
            <p class="muted">Profit: $250K starting ‚Üí aim for positive!</p>
            <p class="muted">Fans: Scale to 20K+ for max points</p>
            <div class="divider"></div>
            <p class="muted"><strong>Win Conditions:</strong></p>
            <p class="muted">‚Ä¢ 40+ & Survived = Pass ‚úÖ<br>
            ‚Ä¢ 60+ = Solid Success<br>
            ‚Ä¢ 70+ = Strong Success<br>
            ‚Ä¢ Special paths: $100K profit OR 20K fans OR Elite TSR 85+ = A+ win!</p>
          </div>
        </details>
      </aside>
    </div>

    <p class="footer">Made for classrooms ¬∑ No logins ¬∑ No servers ¬∑ <span class="kbd">Ctrl/Cmd+S</span> to save this file after playing</p>
  </div>

  <script>
  ;(() => {
    const STARTING = {
      turn: 1,
      turnsTotal: 8,
      cash: 250000,
      salaries: 30000,
      fans: 5000,
      tsr: 60,
      morale: 70,
      rank: 3,
      analysts: 0,
      coaches: 0,
      merchPayoutNext: 0,
      sponsorDealNext: 0,
      negCashStreak: 0,
      history: [],
      name: '',
      seenTutorial: false,
      currentChoices: null
    }

    // Define 20 options for each category
    const OPTIONS_POOL = {
      ops: [
        { id: 'analyst', name: 'Hire Performance Analyst', cost: 20000, tsr: 5, salaries: 5000, desc: 'TSR +5 this turn; +$5K/turn salaries. Improves team performance analysis.' },
        { id: 'coach', name: 'Hire Assistant Coach', cost: 25000, tsr: 3, morale: 5, salaries: 6000, desc: 'TSR +3, Morale +5; +$6K/turn salaries. Helps with training and team culture.' },
        { id: 'house', name: 'Upgrade Team House', cost: 40000, morale: 10, fans: 500, desc: 'Morale +10, Fans +500. Better facilities attract attention.' },
        { id: 'equipment', name: 'New Gaming Equipment', cost: 15000, tsr: 4, desc: 'TSR +4. Latest hardware for competitive edge.' },
        { id: 'nutritionist', name: 'Hire Sports Nutritionist', cost: 18000, morale: 8, salaries: 4000, desc: 'Morale +8; +$4K/turn salaries. Peak physical condition matters.' },
        { id: 'facility', name: 'Lease Premium Facility', cost: 50000, tsr: 6, morale: 8, fans: 800, desc: 'TSR +6, Morale +8, Fans +800. Professional training environment.' },
        { id: 'dataroom', name: 'Build Data Analytics Room', cost: 35000, tsr: 7, desc: 'TSR +7. Advanced stats and opponent analysis.' },
        { id: 'mentalcoach', name: 'Hire Mental Performance Coach', cost: 22000, morale: 12, salaries: 5000, desc: 'Morale +12; +$5K/turn salaries. Handles pressure and mindset.' },
        { id: 'bootcamp_facility', name: 'Bootcamp Facility Rental', cost: 12000, tsr: 5, morale: -3, desc: 'TSR +5, Morale -3. Intense environment for rapid improvement.' },
        { id: 'chef', name: 'Hire Team Chef', cost: 20000, morale: 10, salaries: 4500, desc: 'Morale +10; +$4.5K/turn salaries. Quality meals boost team happiness.' },
        { id: 'lean', name: 'Stay Lean', cost: 0, tsr: -2, desc: 'TSR -2. No infrastructure spend this quarter.' },
        { id: 'manager', name: 'Hire Team Manager', cost: 30000, morale: 6, fans: 400, salaries: 7000, desc: 'Morale +6, Fans +400; +$7K/turn salaries. Handles logistics and PR.' },
        { id: 'scrim_partner', name: 'Contract Scrim Partners', cost: 8000, tsr: 3, desc: 'TSR +3. Regular practice against quality opponents.' },
        { id: 'streaming_setup', name: 'Professional Streaming Setup', cost: 25000, fans: 1200, desc: 'Fans +1,200. Content creation for brand growth.' },
        { id: 'physio', name: 'Hire Physiotherapist', cost: 16000, morale: 7, salaries: 3500, desc: 'Morale +7; +$3.5K/turn salaries. Prevents injuries and fatigue.' },
        { id: 'office', name: 'Open Office Space', cost: 45000, morale: 9, fans: 600, desc: 'Morale +9, Fans +600. Professional headquarters.' },
        { id: 'software', name: 'Training Software Licenses', cost: 10000, tsr: 3, desc: 'TSR +3. Cutting-edge practice tools.' },
        { id: 'consultant', name: 'Strategy Consultant (Contract)', cost: 28000, tsr: 6, desc: 'TSR +6. Expert advice, no permanent salary increase.' },
        { id: 'minimal', name: 'Minimal Operations', cost: 0, desc: 'No operations spend. Save all resources.' },
        { id: 'veteran', name: 'Sign Veteran Player (Sub)', cost: 35000, tsr: 8, morale: -5, salaries: 8000, desc: 'TSR +8, Morale -5; +$8K/turn salaries. Skill but potential ego clash.' }
      ],
      mkt: [
        { id: 'merch', name: 'Launch Fan Merchandise', cost: 25000, fans: 1000, payout: 10000, desc: '+1,000 fans now; +$10K revenue next turn. Store and products.' },
        { id: 'local', name: 'Host Local Tournament', cost: 30000, fans: 2000, morale: 5, desc: 'Fans +2,000, Morale +5. Community engagement event.' },
        { id: 'influencer', name: 'Influencer Partnership', cost: 20000, fans: 1500, desc: 'Fans +1,500. Social media collaboration.' },
        { id: 'sponsor_hunt', name: 'Sponsor Acquisition Campaign', cost: 15000, payout: 25000, desc: '+$25K sponsor deal next turn. Proactive outreach.' },
        { id: 'content_team', name: 'Hire Content Creator', cost: 28000, fans: 800, salaries: 5000, desc: 'Fans +800; +$5K/turn salaries. Consistent video/stream content.' },
        { id: 'billboard', name: 'Billboard Advertising', cost: 35000, fans: 2500, desc: 'Fans +2,500. Big city visibility campaign.' },
        { id: 'social_media', name: 'Social Media Blitz', cost: 12000, fans: 1200, desc: 'Fans +1,200. Coordinated online campaign.' },
        { id: 'charity', name: 'Charity Stream Event', cost: 18000, fans: 1800, morale: 6, desc: 'Fans +1,800, Morale +6. Positive brand image.' },
        { id: 'documentary', name: 'Team Documentary Series', cost: 40000, fans: 3000, desc: 'Fans +3,000. Behind-the-scenes content.' },
        { id: 'podcast', name: 'Start Team Podcast', cost: 8000, fans: 600, desc: 'Fans +600. Low-cost ongoing content.' },
        { id: 'minimal', name: 'Minimal Marketing', cost: 0, desc: 'No marketing spend. Organic growth only.' },
        { id: 'convention', name: 'Gaming Convention Booth', cost: 32000, fans: 2200, desc: 'Fans +2,200. Meet fans in person.' },
        { id: 'giveaway', name: 'Fan Giveaway Campaign', cost: 15000, fans: 1400, desc: 'Fans +1,400. Prizes and engagement.' },
        { id: 'rebrand', name: 'Brand Refresh & New Logo', cost: 22000, fans: 1000, morale: 4, desc: 'Fans +1,000, Morale +4. Fresh image energizes team and fans.' },
        { id: 'esports_bar', name: 'Sponsor Esports Bar Events', cost: 20000, fans: 1600, desc: 'Fans +1,600. Partner with local venues.' },
        { id: 'youtube', name: 'YouTube Channel Push', cost: 10000, fans: 900, desc: 'Fans +900. Video content strategy.' },
        { id: 'press_release', name: 'Press Release Campaign', cost: 5000, fans: 500, desc: 'Fans +500. Traditional media outreach.' },
        { id: 'fan_meetup', name: 'Fan Meetup Events', cost: 14000, fans: 1100, morale: 7, desc: 'Fans +1,100, Morale +7. Players meet supporters.' },
        { id: 'tiktok', name: 'TikTok Marketing Campaign', cost: 11000, fans: 1300, desc: 'Fans +1,300. Short-form viral content.' },
        { id: 'newsletter', name: 'Start Fan Newsletter', cost: 6000, fans: 400, desc: 'Fans +400. Email engagement strategy.' }
      ],
      ply: [
        { id: 'bootcamp', name: 'Intense Training Bootcamp', cost: 0, tsr: 8, morale: -10, desc: 'TSR +8, Morale -10. Grueling practice schedule.' },
        { id: 'retreat', name: 'Team Bonding Retreat', cost: 10000, morale: 10, tsr: -3, desc: 'Morale +10, TSR -3. Leisure and team building.' },
        { id: 'balanced', name: 'Balanced Schedule', cost: 0, tsr: 2, morale: 2, desc: 'TSR +2, Morale +2. Sustainable approach.' },
        { id: 'vod_review', name: 'VOD Review Sessions', cost: 5000, tsr: 4, desc: 'TSR +4. Learn from past matches.' },
        { id: 'scrims', name: 'Extra Scrim Blocks', cost: 8000, tsr: 6, morale: -4, desc: 'TSR +6, Morale -4. More practice time.' },
        { id: 'vacation', name: 'Mandatory Team Vacation', cost: 20000, morale: 15, tsr: -5, desc: 'Morale +15, TSR -5. Rest and relaxation.' },
        { id: 'individual_coaching', name: 'Individual Player Coaching', cost: 15000, tsr: 7, desc: 'TSR +7. Personalized skill development.' },
        { id: 'team_activities', name: 'Weekly Team Activities', cost: 6000, morale: 8, desc: 'Morale +8. Bowling, escape rooms, etc.' },
        { id: 'meditation', name: 'Meditation & Yoga Sessions', cost: 4000, morale: 6, desc: 'Morale +6. Mental clarity and stress relief.' },
        { id: 'lan_bootcamp', name: 'LAN Bootcamp', cost: 12000, tsr: 9, morale: -6, desc: 'TSR +9, Morale -6. Intense offline practice.' },
        { id: 'korean_bootcamp', name: 'Korean Bootcamp Trip', cost: 35000, tsr: 12, morale: -8, fans: 500, desc: 'TSR +12, Morale -8, Fans +500. Train in top region.' },
        { id: 'light_practice', name: 'Light Practice Schedule', cost: 0, tsr: -1, morale: 5, desc: 'TSR -1, Morale +5. Recovery period.' },
        { id: 'sports_psych', name: 'Sports Psychology Workshops', cost: 8000, morale: 9, tsr: 1, desc: 'Morale +9, TSR +1. Mental game training.' },
        { id: 'opponent_prep', name: 'Opponent-Specific Prep', cost: 10000, tsr: 5, desc: 'TSR +5. Study next opponents deeply.' },
        { id: 'internal_tournament', name: 'Internal Tournament', cost: 3000, tsr: 3, morale: 4, desc: 'TSR +3, Morale +4. Friendly competition.' },
        { id: 'replay_analysis', name: 'Professional Replay Analysis', cost: 7000, tsr: 4, desc: 'TSR +4. Expert breakdown of gameplay.' },
        { id: 'team_dinner', name: 'Weekly Team Dinners', cost: 4000, morale: 7, desc: 'Morale +7. Build chemistry over meals.' },
        { id: 'music_room', name: 'Music & Recreation Room', cost: 12000, morale: 10, desc: 'Morale +10. Downtime space for players.' },
        { id: 'no_practice', name: 'No Practice This Quarter', cost: 0, tsr: -4, morale: 8, desc: 'TSR -4, Morale +8. Full break from competitive.' },
        { id: 'hybrid_schedule', name: 'Hybrid Training Schedule', cost: 5000, tsr: 4, morale: 3, desc: 'TSR +4, Morale +3. Mix of practice and rest.' }
      ]
    }

    let S = JSON.parse(JSON.stringify(STARTING))

    const el = id => document.getElementById(id)
    const $stats = el('stats')
    const $scenario = el('scenario')
    const $log = el('log')
    const $name = el('studentName')
    const $modal = el('tutorialModal')

    const fmtMoney = n => `$${n.toLocaleString()}`
    const clamp = (v,min,max) => Math.max(min, Math.min(max, v))
    const rankName = t => t===1? 'Tier 1 (Elite)' : t===2? 'Tier 2 (Challenger)' : 'Tier 3 (Rookie)'

    // Fisher-Yates shuffle
    function shuffle(array) {
      const arr = [...array]
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]]
      }
      return arr
    }

    function selectRandomOptions() {
      const ops = shuffle(OPTIONS_POOL.ops).slice(0, 3)
      const mkt = shuffle(OPTIONS_POOL.mkt).slice(0, 3)
      const ply = shuffle(OPTIONS_POOL.ply).slice(0, 3)
      return { ops, mkt, ply }
    }

    function renderOptions() {
      S.currentChoices = selectRandomOptions()

      const renderCategory = (options, category) => {
        return options.map(opt => {
          const costStr = opt.cost > 0 ? `$${opt.cost.toLocaleString()}` : '$0'
          return `
            <label class="opt">
              <input type="radio" name="${category}" value="${opt.id}">
              <div>
                <b>${opt.name} (${costStr})</b><br>
                <span class="muted">${opt.desc}</span>
              </div>
            </label>
          `
        }).join('')
      }

      el('opsOptions').innerHTML = renderCategory(S.currentChoices.ops, 'ops')
      el('mktOptions').innerHTML = renderCategory(S.currentChoices.mkt, 'mkt')
      el('plyOptions').innerHTML = renderCategory(S.currentChoices.ply, 'ply')
    }

    function displayTurnSummary(summary) {
      const $summary = el('turnSummary')
      const $content = el('turnSummaryContent')
      
      const outcomeColor = summary.tournamentWin ? 'var(--good)' : 'var(--bad)'
      const outcomeIcon = summary.tournamentWin ? 'üèÜ' : 'üíî'
      const cashColor = summary.netCash >= 0 ? 'var(--good)' : 'var(--bad)'
      
      const events = []
      if (summary.rankChange) events.push(`<div style="color:var(--good)">üìà ${summary.rankChange}</div>`)
      if (summary.fanMilestone) events.push(`<div style="color:var(--good)">üéâ ${summary.fanMilestone}</div>`)
      if (summary.warnings && summary.warnings.length > 0) {
        summary.warnings.forEach(w => events.push(`<div style="color:var(--warn)">‚ö†Ô∏è ${w}</div>`))
      }
      
      $content.innerHTML = `
        <div style="background:${summary.tournamentWin ? 'rgba(16,185,129,0.1)' : 'rgba(239,68,68,0.1)'};border:2px solid ${outcomeColor};border-radius:12px;padding:12px;margin-bottom:12px">
          <div style="font-size:18px;font-weight:bold;color:${outcomeColor};margin-bottom:4px">
            ${outcomeIcon} Tournament ${summary.tournamentWin ? 'WIN' : 'LOSS'}
          </div>
          <div style="font-size:14px;color:var(--muted)">
            Win probability: ${summary.winProbability}
          </div>
        </div>
        
        <div style="background:var(--panel-2);border-radius:12px;padding:12px;margin-bottom:12px">
          <div style="font-weight:bold;margin-bottom:8px;color:#cfe1ff">üí∞ Financial Summary</div>
          <div style="display:grid;gap:4px;font-size:14px">
            <div style="display:flex;justify-content:space-between">
              <span class="muted">Revenue:</span>
              <span class="goodtext">+${summary.revenue.toLocaleString()}</span>
            </div>
            <div style="display:flex;justify-content:space-between">
              <span class="muted">Expenses:</span>
              <span class="badtext">-${summary.expenses.toLocaleString()}</span>
            </div>
            <div style="height:1px;background:var(--line);margin:4px 0"></div>
            <div style="display:flex;justify-content:space-between;font-weight:bold">
              <span>Net:</span>
              <span style="color:${cashColor}">${summary.netCash >= 0 ? '+' : ''}${summary.netCash.toLocaleString()}</span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:16px;font-weight:bold;margin-top:4px">
              <span>New Cash:</span>
              <span>${summary.newCash.toLocaleString()}</span>
            </div>
          </div>
        </div>
        
        <div style="background:var(--panel-2);border-radius:12px;padding:12px;margin-bottom:12px">
          <div style="font-weight:bold;margin-bottom:8px;color:#cfe1ff">üìä Stat Changes</div>
          <div style="display:grid;gap:4px;font-size:14px">
            <div style="display:flex;justify-content:space-between">
              <span class="muted">TSR:</span>
              <span style="color:${summary.tsrChange >= 0 ? 'var(--good)' : 'var(--bad)'}">
                ${summary.oldTSR} ‚Üí ${summary.newTSR} (${summary.tsrChange >= 0 ? '+' : ''}${summary.tsrChange})
              </span>
            </div>
            <div style="display:flex;justify-content:space-between">
              <span class="muted">Morale:</span>
              <span style="color:${summary.moraleChange >= 0 ? 'var(--good)' : 'var(--bad)'}">
                ${summary.oldMorale} ‚Üí ${summary.newMorale} (${summary.moraleChange >= 0 ? '+' : ''}${summary.moraleChange})
              </span>
            </div>
            <div style="display:flex;justify-content:space-between">
              <span class="muted">Fans:</span>
              <span style="color:${summary.fanChange >= 0 ? 'var(--good)' : 'var(--bad)'}">
                ${summary.oldFans.toLocaleString()} ‚Üí ${summary.newFans.toLocaleString()} (${summary.fanChange >= 0 ? '+' : ''}${summary.fanChange.toLocaleString()})
              </span>
            </div>
          </div>
        </div>
        
        ${events.length > 0 ? `
        <div style="background:rgba(106,168,255,0.1);border:1px solid var(--accent);border-radius:12px;padding:12px">
          <div style="font-weight:bold;margin-bottom:8px;color:var(--accent)">üåü Special Events</div>
          <div style="font-size:14px;display:grid;gap:4px">
            ${events.join('')}
          </div>
        </div>
        ` : ''}
      `
      
      $summary.style.display = 'block'
      $summary.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
    }

    function render(){
      const yr = Math.floor((S.turn-1) / 4) + 1
      const qtr = ((S.turn-1) % 4) + 1
      const desc = `Year ${yr}, Quarter ${qtr} (Turn ${S.turn} / ${S.turnsTotal})`

      $scenario.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <b>${desc}</b>
          <span class="pill">üí∞ ${fmtMoney(S.cash)}</span>
          <span class="pill">üë• ${S.fans.toLocaleString()} fans</span>
          <span class="pill">üèÜ ${rankName(S.rank)}</span>
        </div>
        <p style="margin-top:8px;font-size:14px" class="muted">Make your three decisions below, then click <b>Confirm Decisions</b> to run the tournament and advance to the next quarter.</p>
      `

      const stat = (key,val,note) => `<div class="stat"><b>${key}</b><div style="font-size:20px;margin:4px 0">${val}</div>${note?`<div class="muted" style="font-size:12px">${note}</div>`:''}</div>`

      $stats.innerHTML = `
        ${stat('Cash', fmtMoney(S.cash), S.cash < 0 ? '<span class="badtext">‚ö† Negative!</span>' : '')}
        ${stat('Salaries / turn', fmtMoney(S.salaries))}
        ${stat('Fans', S.fans.toLocaleString())}
        ${stat('TSR', S.tsr, 'Team Skill Rating')}
        ${stat('Morale', S.morale, S.morale < 30 ? '<span class="warntext">‚ö† Low!</span>' : '')}
        ${stat('Rank', rankName(S.rank))}
      `

      renderOptions()
    }

    function appendLog(lines){
      const arr = Array.isArray(lines) ? lines : [lines]
      arr.forEach(ln => {
        const div = document.createElement('div')
        div.textContent = ln
        div.style.margin = '4px 0'
        $log.appendChild(div)
      })
      $log.scrollTop = $log.scrollHeight
    }

    function getChoice(cat){
      const radio = document.querySelector(`input[name="${cat}"]:checked`)
      return radio ? radio.value : null
    }

    function clearChoices(){
      document.querySelectorAll('input[type="radio"]').forEach(r => r.checked = false)
    }

    function winProbability(){
      const baseOpponent = 60
      const moraleMultiplier = S.morale / 100
      let p = (S.tsr * moraleMultiplier) / baseOpponent
      return clamp(p, 0.05, 0.95)
    }

    function academicFeedback(pl, totals){
      const { revenue, expenses, fixed, variable } = totals
      if (pl < 0 && revenue < fixed) return 'Your revenue did not reach the break‚Äëeven point; fixed costs exceeded contribution margin.'
      if (pl < 0 && variable > fixed) return 'High variable costs eroded margins this turn; tighten discretionary spending.'
      if (pl >= 0 && revenue > expenses) return 'Positive contribution margin covered fixed costs and produced profit‚Äîwell managed.'
      if (pl < 0) return 'A net loss increased liabilities pressure; consider boosting sponsorship assets or cutting costs.'
      return 'Stable performance with costs under control; maintain assets that drive recurring revenue.'
    }

    function applyDecisions(opsId, mktId, plyId){
      let log = []
      
      // Track values for summary
      const oldTSR = S.tsr
      const oldMorale = S.morale
      const oldFans = S.fans
      const oldCash = S.cash

      // Apply payouts from previous turn first
      const merchSales = S.merchPayoutNext
      S.merchPayoutNext = 0
      const sponsorDeal = S.sponsorDealNext
      S.sponsorDealNext = 0

      let variableCosts = 0

      // Find the selected options
      const opsOpt = OPTIONS_POOL.ops.find(o => o.id === opsId)
      const mktOpt = OPTIONS_POOL.mkt.find(o => o.id === mktId)
      const plyOpt = OPTIONS_POOL.ply.find(o => o.id === plyId)

      // Apply operations
      if (opsOpt) {
        variableCosts += opsOpt.cost || 0
        S.tsr += opsOpt.tsr || 0
        S.morale += opsOpt.morale || 0
        S.fans += opsOpt.fans || 0
        S.salaries += opsOpt.salaries || 0
        log.push(`Operations: ${opsOpt.name} (Cost: ${fmtMoney(opsOpt.cost || 0)}${opsOpt.salaries ? `; +${fmtMoney(opsOpt.salaries)}/turn salary` : ''}).`)
      }

      // Apply marketing
      if (mktOpt) {
        variableCosts += mktOpt.cost || 0
        S.fans += mktOpt.fans || 0
        S.morale += mktOpt.morale || 0
        S.salaries += mktOpt.salaries || 0
        if (mktOpt.payout) {
          if (mktOpt.id === 'merch') S.merchPayoutNext = mktOpt.payout
          else S.sponsorDealNext = mktOpt.payout
        }
        log.push(`Marketing: ${mktOpt.name} (Cost: ${fmtMoney(mktOpt.cost || 0)}${mktOpt.payout ? `; +${fmtMoney(mktOpt.payout)} next turn` : ''}${mktOpt.salaries ? `; +${fmtMoney(mktOpt.salaries)}/turn salary` : ''}).`)
      }

      // Apply player focus
      if (plyOpt) {
        variableCosts += plyOpt.cost || 0
        S.tsr += plyOpt.tsr || 0
        S.morale += plyOpt.morale || 0
        S.fans += plyOpt.fans || 0
        log.push(`Player Focus: ${plyOpt.name} (Cost: ${fmtMoney(plyOpt.cost || 0)}).`)
      }

      S.tsr = clamp(Math.round(S.tsr), 0, 100)
      S.morale = clamp(Math.round(S.morale), 0, 100)

      // Tournament
      const pWin = winProbability()
      const didWin = Math.random() < pWin
      const prizeTable = {1: 60000, 2: 35000, 3: 20000}
      let prizeMoney = didWin ? prizeTable[S.rank] : 0

      if (didWin){
        S.fans += 1500
        log.push(`Tournament outcome: WIN (p=${(pWin*100).toFixed(1)}%). Prize ${fmtMoney(prizeMoney)}, Fans +1,500.`)
      } else {
        variableCosts += 10000
        const fansBefore = S.fans
        S.fans = Math.max(0, Math.round(S.fans * 0.95))
        log.push(`Tournament outcome: LOSS (p=${(pWin*100).toFixed(1)}%). Sponsor penalty ‚àí$10,000; Fans ${fansBefore.toLocaleString()} ‚Üí ${S.fans.toLocaleString()} (‚àí5%).`)
      }

      // Financial calculation
      const sponsorships = Math.round((S.rank === 1 ? 30000 : S.rank === 2 ? 18000 : 9000) + Math.max(0, S.tsr - 50) * 120)
      const fixedExpenses = S.salaries
      const travel = 5000
      variableCosts += travel

      const totalRevenue = sponsorships + merchSales + sponsorDeal + prizeMoney
      const totalExpenses = fixedExpenses + variableCosts
      const profitLoss = totalRevenue - totalExpenses

      S.cash += profitLoss

      // Rank updates
      let promoted = false, demoted = false
      let rankChangeText = ''
      const oldRank = S.rank
      if (S.rank === 3 && S.tsr >= 70 && S.fans >= 7000){ S.rank = 2; promoted = true }
      else if (S.rank === 2 && S.tsr >= 80 && S.fans >= 12000){ S.rank = 1; promoted = true }
      else if (S.tsr <= 50 && S.morale <= 40 && S.fans < 5000 && S.rank < 3){ S.rank = 3; demoted = true }
      if (promoted) {
        rankChangeText = `Promoted to ${rankName(S.rank)}!`
        log.push(`Rank update: ${rankChangeText}`)
      }
      if (demoted) {
        rankChangeText = `Demoted to ${rankName(S.rank)}`
        log.push(`Rank update: ${rankChangeText}`)
      }

      // Fan milestones
      let fanMilestone = ''
      if (oldFans < 10000 && S.fans >= 10000) fanMilestone = '10K Fan Milestone! Sponsor Bonus +$20K'
      else if (oldFans < 15000 && S.fans >= 15000) fanMilestone = '15K Fan Milestone! Major Sponsor +$30K'
      else if (oldFans < 25000 && S.fans >= 25000) fanMilestone = '25K Fan Milestone! Elite Sponsorship +$50K'

      const fb = academicFeedback(profitLoss, {
        revenue: totalRevenue,
        expenses: totalExpenses,
        fixed: fixedExpenses,
        variable: variableCosts
      })

      const revenueBreakdown = []
      if (sponsorships > 0) revenueBreakdown.push(`Sponsors ${fmtMoney(sponsorships)}`)
      if (prizeMoney > 0) revenueBreakdown.push(`Prize ${fmtMoney(prizeMoney)}`)
      if (merchSales > 0) revenueBreakdown.push(`Merch ${fmtMoney(merchSales)}`)
      if (sponsorDeal > 0) revenueBreakdown.push(`Deal ${fmtMoney(sponsorDeal)}`)

      log.push(
        `Revenue: ${revenueBreakdown.join(' + ')} = ${fmtMoney(totalRevenue)}`,
        `Expenses: Fixed ${fmtMoney(fixedExpenses)} + Variable ${fmtMoney(variableCosts)} = ${fmtMoney(totalExpenses)}`,
        `Turn Net: ${profitLoss >= 0 ? '+' : ''}${fmtMoney(profitLoss)}`,
        `Cash: ${fmtMoney(S.cash)} ‚Ä¢ TSR: ${S.tsr} ‚Ä¢ Morale: ${S.morale} ‚Ä¢ Fans: ${S.fans.toLocaleString()}`,
        `üí° ${fb}`
      )

      appendLog(log)

      // Build turn summary
      const warnings = []
      if (S.cash < 0) warnings.push('Negative cash - 1 more turn = bankruptcy!')
      if (S.morale < 30) warnings.push('Low morale - risk of player mutiny!')
      
      displayTurnSummary({
        tournamentWin: didWin,
        winProbability: `${(pWin*100).toFixed(1)}%`,
        revenue: totalRevenue,
        expenses: totalExpenses,
        netCash: profitLoss,
        newCash: fmtMoney(S.cash),
        oldTSR: oldTSR,
        newTSR: S.tsr,
        tsrChange: S.tsr - oldTSR,
        oldMorale: oldMorale,
        newMorale: S.morale,
        moraleChange: S.morale - oldMorale,
        oldFans: oldFans,
        newFans: S.fans,
        fanChange: S.fans - oldFans,
        rankChange: rankChangeText,
        fanMilestone: fanMilestone,
        warnings: warnings
      })

      // Failure checks
      if (S.cash < 0) S.negCashStreak = (S.negCashStreak||0) + 1; else S.negCashStreak = 0
      if (S.negCashStreak >= 2){
        gameOver('Financial Ruin', 'Cash reserves were below $0 for two consecutive turns.')
        return
      }
      if (S.morale <= 0){
        gameOver('Mutiny', 'Player morale fell to 0. The roster refuses to compete.')
        return
      }
    }

    function gameOver(reason, detail){
      const report = `\nGAME OVER ‚Äî ${reason}\n${detail}\nFinal Cash: ${fmtMoney(S.cash)}\nFans: ${S.fans.toLocaleString()}\nRank: ${rankName(S.rank)}\nTurns played: ${S.turn} / ${S.turnsTotal}`
      appendLog(report)
      el('btnConfirm').disabled = true
      $scenario.innerHTML = `<div class="notice badtext"><b>Game Over:</b> ${reason}. ${detail}</div>`
    }

    function endIfNeeded(){
      if (S.turn > S.turnsTotal){
        const endingCash = S.cash
        const endingRank = S.rank
        const endingFans = S.fans
        const profit = endingCash - STARTING.cash

        const rankSub = (endingRank === 1 ? 100 : endingRank === 2 ? 60 : 30)
        const profitSub = (function(){
          const min = -100000, max = 200000
          const pct = (profit - min) / (max - min)
          return clamp(Math.round(pct*100), 0, 100)
        })()
        const fanSub = clamp(Math.round((endingFans / 20000) * 100), 0, 100)

        const finalScore = Math.round(rankSub*0.40 + profitSub*0.40 + fanSub*0.20)

        // Determine achievement level and win status
        function getAchievement(score, rank, profit, fans, cash) {
          // Check for special achievements
          const survived = cash >= 0
          const elite = endingRank === 1
          const profitable = profit > 0
          const fanMilestone = fans >= 15000
          
          // Alternative win conditions (can win by excelling in one area)
          const domination = elite && fans >= 15000 && profit > 50000 // All three strong
          const financialMogul = profit > 100000 // Pure profit focus
          const brandBuilder = fans >= 20000 && endingRank <= 2 // Fanbase empire
          const eliteCompetitor = elite && S.tsr >= 85 // Peak performance
          
          if (domination) return { 
            grade: 'S', 
            title: 'üèÜ TOTAL DOMINATION', 
            desc: 'Elite rank, massive fanbase, huge profit. You are a legendary esports manager!',
            color: 'gold',
            win: true
          }
          
          if (financialMogul || brandBuilder || eliteCompetitor) return {
            grade: 'A+',
            title: '‚≠ê EXCEPTIONAL SUCCESS',
            desc: financialMogul ? 'Financial genius! You built a highly profitable organization.' : 
                  brandBuilder ? 'Brand empire! Your fanbase is massive and sponsors love you.' :
                  'Elite competitor! Your team dominates at the highest level.',
            color: 'gold',
            win: true
          }
          
          if (score >= 70) return { 
            grade: 'A', 
            title: 'üéØ STRONG SUCCESS', 
            desc: 'Excellent management across the board. Your org is thriving!',
            color: 'good',
            win: true
          }
          
          if (score >= 60) return { 
            grade: 'B+', 
            title: '‚úÖ SOLID SUCCESS', 
            desc: 'Good performance! You built a sustainable esports organization.',
            color: 'good',
            win: true
          }
          
          if (score >= 50 && survived) return { 
            grade: 'B', 
            title: 'üëç MODERATE SUCCESS', 
            desc: 'Decent results. You kept the lights on and showed promise.',
            color: 'good',
            win: true
          }
          
          if (score >= 40 && survived) return { 
            grade: 'C', 
            title: 'üìä PASSING', 
            desc: 'You survived 8 turns without bankruptcy. That\'s a win in this business!',
            color: 'warn',
            win: true
          }
          
          if (survived) return { 
            grade: 'D', 
            title: 'üòÖ SURVIVED', 
            desc: 'The team survived but struggled. Learn from this experience.',
            color: 'warn',
            win: false
          }
          
          return { 
            grade: 'F', 
            title: '‚ùå FAILED', 
            desc: 'Bankruptcy or mutiny ended your run early. Try a different strategy!',
            color: 'bad',
            win: false
          }
        }
        
        const achievement = getAchievement(finalScore, endingRank, profit, endingFans, endingCash)

        function assessment(){
          const avoidedRuin = (S.negCashStreak||0) < 2 && !(endingCash < 0)
          const balanced = (S.tsr >= 60 && S.morale >= 60) || (profit > 0 && endingRank <= 2)
          const profitable = profit > 0
          const a = avoidedRuin ? 'You avoided financial ruin' : 'You flirted with financial ruin'
          const b = balanced ? 'balanced short‚Äëterm performance with long‚Äëterm capability building' : 'over‚Äëweighted either short‚Äëterm pushes or long‚Äëterm investments'
          const c = profitable ? 'your revenues exceeded expenses to produce profit' : 'expenses outpaced revenues, resulting in a loss'
          return `${a}, ${b}, and ${c}. Consider how fixed costs (salaries) and variable decisions (marketing, travel, retreats) influenced contribution margin and your path to break‚Äëeven.`
        }

        const stat = (key,val,note) => `<div class="stat"><b>${key}</b><div style="font-size:20px;margin:4px 0">${val}</div>${note?`<div class="muted" style="font-size:12px">${note}</div>`:''}</div>`

        const achievementColor = achievement.color === 'gold' ? '#fbbf24' : 
                                  achievement.color === 'good' ? 'var(--good)' :
                                  achievement.color === 'warn' ? 'var(--warn)' : 'var(--bad)'

        const screen = `
          <div class="notice" style="background:rgba(106,168,255,0.1);border-color:${achievementColor}">
            <div style="text-align:center">
              <div style="font-size:48px;font-weight:bold;color:${achievementColor};margin-bottom:8px">${achievement.grade}</div>
              <div style="font-size:24px;font-weight:bold;margin-bottom:8px">${achievement.title}</div>
              <div style="font-size:16px;color:var(--muted)">${achievement.desc}</div>
              ${achievement.win ? '<div style="margin-top:12px;font-size:18px;color:var(--good)">üéâ YOU WIN! üéâ</div>' : '<div style="margin-top:12px;font-size:16px;color:var(--warn)">Try again for a better result!</div>'}
            </div>
          </div>
          <div class="divider"></div>
          <h3>Final Statistics</h3>
          <div class=\"stats\">
            ${stat('Student', (S.name && S.name.trim()) ? S.name.trim() : 'Manager X', '')}
            ${stat('Final Cash Reserves', fmtMoney(endingCash), endingCash < 0 ? '<span class="badtext">Bankrupt</span>' : '')}
            ${stat('Profit/Loss', (profit >= 0 ? '+' : '') + fmtMoney(profit), profit >= 0 ? '<span class="goodtext">Profitable</span>' : '<span class="badtext">Loss</span>')}
            ${stat('Final Team Rank', rankName(endingRank), '')}
            ${stat('Team Skill (TSR)', S.tsr, '')}
            ${stat('Final Fan Base', endingFans.toLocaleString() + ' followers', '')}
          </div>
          <div class=\"divider\"></div>
          <div class="section-title">Score Breakdown (out of 100)</div>
          <div class="stat">Rank Score (40%): ${rankSub} ‚Üí √ó0.40 = ${(rankSub*0.40).toFixed(1)}</div>
          <div class="stat">Profit Score (40%): ${profitSub} ‚Üí √ó0.40 = ${(profitSub*0.40).toFixed(1)}</div>
          <div class="stat">Fan Base Score (20%): ${fanSub} ‚Üí √ó0.20 = ${(fanSub*0.20).toFixed(1)}</div>
          <div class="stat" style="background:${achievementColor === 'var(--bad)' ? 'var(--panel-2)' : 'rgba(106,168,255,0.1)'};border-color:${achievementColor}"><b>Final Score</b>: ${finalScore} / 100</div>
          <div class=\"divider\"></div>
          <details open>
            <summary>üìù Performance Analysis</summary>
            <p class="muted" style="margin-top:8px">${assessment()}</p>
          </details>
          <div class=\"divider\"></div>
          <div class="notice" style="background:var(--panel-2)">
            <b>Win Conditions:</b>
            <ul class="muted" style="font-size:14px;margin:8px 0">
              <li><b>40+ Score & Survived</b> = Passing ‚úÖ</li>
              <li><b>50+ Score</b> = Moderate Success üëç</li>
              <li><b>60+ Score</b> = Solid Success ‚úÖ‚úÖ</li>
              <li><b>70+ Score</b> = Strong Success üéØ</li>
              <li><b>Special Achievements:</b> Elite Rank + 15K Fans + $50K Profit = Total Domination üèÜ</li>
              <li><b>Alternative Wins:</b> $100K+ Profit OR 20K+ Fans OR Elite TSR 85+ = Exceptional Success ‚≠ê</li>
            </ul>
          </div>
          <div class=\"divider\"></div>
          <div class="end"><button id="btnPDF" class="btn good"><b>Save Final Report (PDF)</b></button></div>
        `

        $scenario.innerHTML = screen
        const pdfBtn = document.getElementById('btnPDF'); if(pdfBtn){ pdfBtn.addEventListener('click', ()=>window.print()) }
        appendLog([`\nFINAL VALUES: Cash ${fmtMoney(endingCash)} ¬∑ Rank ${rankName(endingRank)} ¬∑ Fans ${endingFans.toLocaleString()}`])
        el('btnConfirm').disabled = true
      }
    }

    // UI events
    el('btnConfirm').addEventListener('click', () => {
      if (S.turn > S.turnsTotal){ return }
      const ops = getChoice('ops')
      const mkt = getChoice('mkt')
      const ply = getChoice('ply')
      if (!ops || !mkt || !ply){
        alert('Please make exactly one selection in each category (Operations, Marketing, Player Focus).')
        return
      }
      if (!$name || !($name.value || '').trim()){
        if (!confirm('Proceed without entering a student name? It will show as "Manager X" on the final report.')) return
        S.name = ''
      } else {
        S.name = ($name.value || '').trim()
      }

      applyDecisions(ops, mkt, ply)
      clearChoices()

      S.turn += 1
      render()
      endIfNeeded()
      saveLocal('autosave', S)
    })

    el('btnReset').addEventListener('click', () => {
      if (!confirm('Reset game to Turn 1?')) return
      S = JSON.parse(JSON.stringify(STARTING))
      S.seenTutorial = true
      $log.textContent = ''
      el('turnSummary').style.display = 'none'
      render()
      el('btnConfirm').disabled = false
      saveLocal('autosave', S)
    })

    el('btnPrint').addEventListener('click', () => window.print())

    el('btnSave').addEventListener('click', () => {
      const blob = new Blob([JSON.stringify(S, null, 2)], {type:'application/json'})
      const a = document.createElement('a')
      a.href = URL.createObjectURL(blob)
      a.download = 'managerx-save.json'
      a.click()
      URL.revokeObjectURL(a.href)
    })

    el('btnLoad').addEventListener('click', () => {
      const inp = document.createElement('input')
      inp.type = 'file'
      inp.accept = '.json,application/json'
      inp.onchange = () => {
        const f = inp.files && inp.files[0]
        if (!f) return
        const reader = new FileReader()
        reader.onload = () => {
          try{
            const data = JSON.parse(reader.result)
            Object.assign(S, data)
            S.seenTutorial = true
            render()
            $log.textContent = ''
            appendLog('Save loaded. Continue your run!')
          }catch(err){ alert('Could not load save file.') }
        }
        reader.readAsText(f)
      }
      inp.click()
    })

    el('btnHelp').addEventListener('click', () => {
      $modal.style.display = 'flex'
    })

    el('btnStartGame').addEventListener('click', () => {
      $modal.style.display = 'none'
      S.seenTutorial = true
      saveLocal('autosave', S)
    })

    // Dismiss turn summary button
    document.addEventListener('click', (e) => {
      if (e.target.id === 'btnDismissSummary') {
        el('turnSummary').style.display = 'none'
      }
    })

    function saveLocal(key, obj){ try{ localStorage.setItem(key, JSON.stringify(obj)) }catch(_){} }
    function loadLocal(key){ try{ return JSON.parse(localStorage.getItem(key)||'null') }catch(_){ return null } }

    const auto = loadLocal('autosave')
    if (auto && auto.turn && auto.turn <= auto.turnsTotal+1){
      S = auto
      appendLog('Autosave loaded. Continue where you left off!')
      if (!S.seenTutorial){
        $modal.style.display = 'flex'
      }
    } else {
      appendLog('Welcome, Manager X! Click the Tutorial button if this is your first time playing.')
      $modal.style.display = 'flex'
    }

    render()
  })()
  </script>
</body>
</html>
</html>


